# TDD는 죽었다 - 2

이제 5장의 내용이다.

``` 
list/templates/home.html

<h1>Your To-Do list</h1>
        <form method="POST">
            <input id="id_new_item" placeholder="작업 아이템 입력"/>
            <table id="id_list_table"></table>
        </form>
```

위와 같이 form 태그와 POST요청을 추가해주자.

functional_test.py를 실행하면 CSRF 에러를 보여준다.

![CSRF ERROR](/img/csrf.png)

CSRF 에러를 해결하기 위해서 {% csrf_token %}를 추가해준다.

이후 또 무의미한 에러발생을 지나고 이제 DB를 마주하게 된다.

책의 내용에 의하면 순수주의자들(TDD 신봉자들인듯하다)은 단위 테스트는 데이터베이스를 건드리면 안된다고 한다.   
왜냐하면 순수한 코드 테스트가 아닌 외부 시스템에 의존한 코드이기 때문이라고 한다. 물론 현시점에서는 무시해도 좋다고한다.    
앞서 보아온 여러 당연한 에러들 처럼.

이제 model을 작성한다. Item이라는 모델이다.

```
class Item(models.Model):
	text = models.TextField(default='')

```

이런 간단한 모델 또한 에러를 보고 어떤게 필요한지 확인하고 마무리를 한다.   (default가 추가된 이유는 본문에서 생략되었다.)    

이쯤되면 무엇이 필요한지 알고서 에러를 발생시키고 '이런게 있으니 다음엔 주의해'라고 말하는거같다. 처음부터 필요한걸 알려줬다면 아마 글제목은 바뀌었을거다.

이후 POST 요청에 대해서 4가지 작업을 진행한다.
- 비어있는 요청에 대해서는 저장하지 않는다.
- 테스트가 너무 길면 나눠서 테스트를 진행해라.
- 테이블에 아이템 여러 개 표시하기.
- 하나 이상의 목록 지원하기.

비어있는 요청에 대해서는 저장하지 않는다고 하였는데 POST요청에 대해서만 분기처리를 해주었다.   
그리고 POST요청에 대해서는 꼭 이후 redirect를 해준다고한다.   
redirect도 해주도록 하자. 테스트와 함께.

앞선 POST 요청에 대한 테스트는 한개의 테스트로 진행되었다.   
저자는 테스트가 길기때문에(정확히는 기능이 다르기 때문에) 이를 데이터를 저장하는지 관하여 데이터를 저장하는 부분과 응답에 관련된 테스트로 나누어 진행하였다.

이제 템플릿에 보여줘야한다. 템플릿 구문 {% for ... in ... %}을 사용한다.  
템플릿에 보여주기 위해서는 GET요청에 대해서 return값에 딕셔너리 형식으로 데이터를 전달해야하기 때문에 views.py를 수정해주고   
아까 작성한 models.py를 migrate해주며(models.py는 아까 작성했지만 migrate는 에러와 함께 진행한다.)   
템플릿 구문을 사용하여 table을 만든다. 
이후 역시 테스트를 통해 잘 작성 되어있는지 확인한다. 

여기까지가 5장의 내용이다.

django의 기능을 테스트를 기반으로 설명하고있다. 기능을 알려주기위한 테스트인지 테스트를 위해 기능을 알려주는것인지 조차 모르겠다. 

총 22개의 장 중에 고작 5개의 장을 진행했을뿐인데 벌써 TDD가 싫어진다. (코드블럭이 두개밖에 없는 가장 큰 이유이다.) 

__TDD는 죽어있음이 틀림없다.__